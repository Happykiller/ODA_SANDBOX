var wowhead_tooltips={colorlinks:!0,iconizelinks:!0,renamelinks:!0};!function(){"use strict";function _init(){$.Oda.Event.addListener({name:"oda-fully-loaded",callback:function(e){$.Oda.App.startApp()}})}var VERSION="0.1";$.Oda.App={version:VERSION,colorCard:{Commune:"#848484",Commune_inv:"#B0B0B0",Rare:"#2E2EFE",Rare_inv:"#5A5AFF","Épique":"#8904B1","Épique_inv":"#AA61C1","Légendaire":"#FF8000","Légendaire_inv":"#FFB163"},colorClasse:{Death_Knight:"#C41F3B",Druide:"#FF7D0A",Chasseur:"#ABD473",Mage:"#69CCF0",Moine:"#00FF96",Paladin:"#F58CBA","Prêtre":"#FFFFFF",Voleur:"#FFF569",Chaman:"#0070DE","Démoniste":"#9482C9",Guerrier:"#C79C6E"},chosenClass:"",tab_sets:["Tous","Expert","La Malédiction de Naxxramas","Gobelins et Gnomes","Mont Rochenoire"],example:function(p_params){try{return!0}catch(er){return $.Oda.Log.error("$.Oda.App.example : "+er.message),null}},startApp:function(p_params){try{return $.Oda.Context.projectLabel="ODA HOW",$.Oda.Router.addDependencies("wowhead",{ordered:!1,list:[{elt:"http://wowjs.zamimg.com/widgets/power.js",type:"script"}]}),$.Oda.Router.addRoute("home",{path:"partials/home.html",title:"oda-main.home-title",urls:["","home"],dependencies:["dataTables","wowhead"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("saisir_paquet",{path:"partials/paquet-add.html",title:"paquet-add.title",urls:["saisir_paquet"],dependencies:["dataTables","wowhead"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("rapports_cartes",{path:"partials/rapports_cartes.html",title:"rapports-cartes.title",urls:["rapports_cartes"],dependencies:["dataTables","hightcharts","wowhead"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("gerer_collection",{path:"partials/gerer_collection.html",title:"gerer-coll.title",urls:["gerer_collection"],dependencies:["dataTables","wowhead"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("gerer_deck",{path:"partials/gerer_deck.html",title:"gerer-deck.title",urls:["gerer_deck"],dependencies:["dataTables","hightcharts"],middleWares:["support","auth"]}),$.Oda.Router.startRooter(),this}catch(er){return $.Oda.Log.error("$.Oda.App.startApp : "+er.message),null}},Controler:{GererDeck:{start:function(p_params){try{return $.Oda.App.Controler.GererDeck.loadListDeck(),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.GererDeck.start : "+er.message),null}},loadListDeck:function(p_params){try{$.Oda.Display.loading({elt:$("#listDeckContent")});var tabSetting={functionRetour:function(p_retour){var strhtml='<table cellpadding="0" cellspacing="0" border="0" class="display hover" id="table_listDeck" style="width: 100%"></table>';$("#listDeckContent").html(strhtml);{var objDataTable=$.Oda.Tooling.objDataTableFromJsonArray(p_retour.data.listDeck.data);$("#table_listDeck").dataTable({sPaginationType:"full_numbers",iDisplayLength:20,aaData:objDataTable.data,aaSorting:[[5,"desc"],[2,"desc"]],aoColumns:[{sTitle:"Nom"},{sTitle:"Classe"},{sTitle:"Quote"},{sTitle:"Type"},{sTitle:"Date",sClass:"dataTableColCenter",sWidth:"175px"},{sTitle:"Actif",sClass:"dataTableColCenter"},{sTitle:"Action",sClass:"dataTableColCenter"}],aoColumnDefs:[{mRender:function(data,type,row){var strHtml="<a href=\"javascript:$.Oda.App.Controler.GererDeck.seeDeck({id:'"+row[0]+"'});\">"+row[1]+"</a>";return strHtml},aTargets:[0]},{mRender:function(data,type,row){var strHtml=row[2];return strHtml},aTargets:[1]},{mRender:function(data,type,row){var quote=parseInt(row[objDataTable.entete.quote]);return"display"===type?quote+"%":quote},aTargets:[2]},{mRender:function(data,type,row){var strHtml=row[3];return strHtml},aTargets:[3]},{mRender:function(data,type,row){var strHtml=row[4];return strHtml},aTargets:[4]},{mRender:function(data,type,row){var strHtml=row[5];return strHtml},aTargets:[5]},{mRender:function(data,type,row){var strHtml='<button class="btn btn-default btn-xs" onclick="$.Oda.App.Controler.ManageDeck.editDeck({id:\''+row[0]+'\'});" href="#">Ouvrir le deck</button>';return strHtml},aTargets:[6]}],fnDrawCallback:function(oSettings){$("#table_listDeck").removeClass("display").addClass("table table-striped table-bordered")}})}}},tabInput={code_user:$.Oda.Session.code_user,option_actif:"",type:""};return $.Oda.Interface.callRest($.Oda.Context.rest+"phpsql/getListDeck.php",tabSetting,tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.GererDeck.loadListDeck : "+er.message),null}},seeDeck:function(p_params){try{{$.Oda.Interface.callRest($.Oda.Context.rest+"phpsql/getHeaderDeck.php",{functionRetour:function(data){var strHtmlDetails=$.Oda.Display.TemplateHtml.create({template:"deck-details",scope:{deckActif:data.data.resultat.actif,deckName:data.data.resultat.nom_deck,deckType:data.data.resultat.type,deckCmt:data.data.resultat.commentaire}}),strHtmlFooter="";strHtmlFooter+='<button type="button" onclick="$.Oda.App.Controler.GererDeck.recHeaderDeck({deckId : '+p_params.id+", oldName : '"+data.data.resultat.nom_deck+'\'});" class="btn btn-primary" oda-submit="bt_valider"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> '+$.Oda.I8n.get("oda-main","bt-submit")+"</button>",strHtmlFooter+='<a href="javascript:$.Oda.Display.Popup.close();" class="btn btn-default" id="bt_annuler_user"><span class="glyphicon glyphicon-ban-circle" aria-hidden="true"></span> '+$.Oda.I8n.get("oda-main","bt-cancel")+"</a>",$.Oda.Display.Popup.open({size:"lg",label:'<span oda-label="gerer-deck.detailsDeck"></span> : '+data.data.resultat.nom_deck,details:strHtmlDetails,footer:strHtmlFooter,callback:function(data){$.Oda.Interface.callRest($.Oda.Context.rest+"phpsql/getDeckDetails.php",{functionRetour:function(data){var datas=$.Oda.App.Controler.GererDeck.buildDatasForGraph(data.data);$("#div_graphCout").highcharts({chart:{type:"column"},title:{text:"La curve"},tooltip:{enabled:!1},exporting:{enabled:!1},xAxis:{categories:datas.categories},yAxis:{gridLineColor:"transparent",title:{enabled:!1},labels:{enabled:!1}},plotOptions:{column:{dataLabels:{enabled:!0,formatter:function(){return"Total"==this.x?10*this.y:this.y}}}},series:datas.series}),$("#div_graphRepart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Type de carte"},tooltip:{pointFormat:"Nombre : {point.y}: <br> Pourcentage : {point.percentage:.1f}%"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"{point.y} {point.name}(s)<br>{point.percentage:.1f}%",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Type",data:datas.dataSeries}]})}},{id_deck:p_params.id,code_user:$.Oda.Session.code_user})}}),$.Oda.Scope.refresh=function(){$("#deckName").data("isOk")&&$("#deckType").data("isOk")?$("#bt_valider").removeClass("disabled"):$("#bt_valider").addClass("disabled")}}},{id_deck:p_params.id})}return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.GererDeck.seeDeck : "+er.message),null}},recHeaderDeck:function(p_params){try{var input_actif=$("#deckActif").val(),input_nom=$("#deckName").val(),input_type=$("#deckType").val(),input_cmt=$("#deckCmt").val();if(""!==input_nom)if(p_params.oldName!==input_nom){var tabInput={code_user:$.Oda.Session.code_user,nomDeck:input_nom};$.Oda.Interface.callRest($.Oda.Context.rest+"phpsql/checkNomDeck.php",{context:{idDeck:p_params.deckId},functionRetour:function(json_retour){if("0"!==json_retour.data.resultat.exists)$.Oda.Display.Notification.warning("Nom du deck déjà existant.");else var tabInput={id_deck:json_retour.context.idDeck,input_actif:"on"===input_actif?1:0,input_nom:input_nom,input_type:input_type,input_cmt:input_cmt},json_retour=$.Oda.Interface.callRest($.Oda.Context.rest+"phpsql/setHeaderDeck.php",{functionRetour:function(json_retour){$.Oda.App.Controler.GererDeck.loadListDeck(),$.Oda.Display.Popup.close(),$.Oda.Display.Notification.success("Mise &agrave; jour r&eacute;ussi.")}},tabInput)}},tabInput)}else{var tabInput={id_deck:p_params.deckId,input_actif:"on"===input_actif?1:0,input_nom:"",input_type:input_type,input_cmt:input_cmt};$.Oda.Interface.callRest($.Oda.Context.rest+"phpsql/setHeaderDeck.php",{functionRetour:function(json_retour){$.Oda.App.Controler.GererDeck.loadListDeck(),$.Oda.Display.Popup.close(),$.Oda.Display.Notification.success("Mise &agrave; jour r&eacute;ussi.")}},tabInput)}else $.Oda.Display.Notification.warning("Nom du deck vide.");return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.GererDeck.recHeaderDeck : "+er.message),null}},buildDatasForGraph:function(p_datas){try{var obj={categories:["0","1","2","3","4","5","6","7+","Total"],series:[]},data={name:"Coût",color:"#0040FF"},array=[];for(var indice in p_datas.coutRepartition.data)array[array.length]=parseInt(p_datas.coutRepartition.data[indice].nb);array[array.length]=parseInt(p_datas.coutSum)/10,data.data=array,obj.series[obj.series.length]=data;var data={name:"Vie",color:"#BA1F1F"},array=[];for(var indice in p_datas.vieRepartition.data)array[array.length]=parseInt(p_datas.vieRepartition.data[indice].nb);array[array.length]=parseInt(p_datas.vieSum)/10,data.data=array,obj.series[obj.series.length]=data;var data={name:"Attaque",color:"#D8E524"},array=[];for(var indice in p_datas.attaqueRepartition.data)array[array.length]=parseInt(p_datas.attaqueRepartition.data[indice].nb);array[array.length]=parseInt(p_datas.attaqueSum)/10,data.data=array,obj.series[obj.series.length]=data;var array=[];for(var indice in p_datas.reparType.data){var data={name:"",y:0};data.name=p_datas.reparType.data[indice].type,data.y=parseInt(p_datas.reparType.data[indice].nb),array[array.length]=data}return obj.dataSeries=array,obj}catch(er){$.Oda.Log.error("buildSimpleSeriesForSimpleColumn :"+er.message)}}}}},_init()}();